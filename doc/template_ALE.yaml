## Template parameters file for using IQ-TREE+ALE

## TO EDIT #############################################################################
run:
   name: &run_name       # REQUIRED: run name (ex: 'template')
   dir:
      - &run_dir_scripts # REQUIRED: directory containing AGO tool-specific scripts      
      - &run_dir_exp     # OPTIONAL: directory for experiments scripts, results, log, statistics and auxiliary files
      - &run_dir_bin     # OPTIONAL: directory for external tools
slurm:
   account: &slurm_account # REQUIRED: SLURM account name (ex: 'def-chauvec')
dir:
   data:    &dir_data    # REQUIRED: directory of run data         (ex: !join [*run_dir_exp, 'data'])
   aux:     &dir_aux     # REQUIRED: directory of auxiliary files  (ex: !join [*run_dir_exp, 'aux'])
   log:     &dir_log     # REQUIRED: directory of log files        (ex: !join [*run_dir_exp, 'log'])
   stats:   &dir_stats   # REQUIRED: directory of statistics files (ex: !join [*run_dir_exp, 'statistics'])
   results: &dir_results # REQUIRED: directory of results files    (ex: !join [*run_dir_exp, 'results'])
data:
   species_tree:
      path: &data_species_tree_path      # REQUIRED: path to species tree
   species:
      path: &data_species_path           # REQUIRED: path to species file      
      # Can be generated by `python *run_dir_scripts/newick_utils.py species *data_species_tree_path`
   families:
      path: &data_families_path          # REQUIRED: path to families file      
      sep:  &species_gene_name_separator # REQUIRED: character to separate gene ame and species name (ex: '|')
   gene_orders:
      path: &data_gene_orders_path       # REQUIRED: path to gene orders file
   sequences:
      path: &data_sequences_path         # REQUIRED for tool.MACSE: path to sequences file
   alignments:
      path: &data_alignments_path        # REQUIRED for tool.GeneRax and tool.IQ-TREE: path to MSA file
      NT_ext: &data_alignments_NT_ext    # REQUIRED for tool.MACSE, suffixes for nucleotides alignments files (ex: '_NT.fasta')
      AA_ext: &data_alignments_AA_ext    # REQUIRED for tool.MACSE, suffixes for amino-acids alignments files (ex: '_AA.fasta')
   gene_trees:
      path: &data_gene_trees_path        # REQUIRED for tool.IQ-TREE and tool.ALE: path to gene trees file
   reconciliations:
      path:  &data_reconciliations_path  # REQUIRED for tool.GeneRax, tool.ALE and tool.DeCoSTAR: path to reconciled gene trees file
      ext:   &data_reconciliations_ext   # REQUIRED for tool.GeneRax, tool.ALE and tool.DeCoSTAR: extension to reconciled gene trees files (ex: '.recphyloxml')
   adjacencies:
      path:  &data_adjacencies_path      # REQUIRED for tool.DCoSTAR, tool.SPPDCJ_ILP and tool.SPPDCJ: path to adjacencies file
      path:  &data_ago_adjacencies_path  # REQUIRED for tool.DCoSTAR, tool.SPPDCJ_ILP and tool.SPPDCJ: path to reconstructed extant and ancestral adjacencies file
# External tools options
tools:
   # MACSE
   - &macse_exec                     # REQUIRED: path to java MACSE .jar file                      (ex: !join [*run_dir_bin, 'macse_v2.06.jar'])
   - &macse_modules                  # REQUIRED: modules needed to run MACSE                       (ex: 'java', use '' if non is needed)
   - &macse_slurm_options            # REQUIRED: MACSE slurm options                               (ex: '--mem=8G --time=02:00:00')
   # IQ-TREE
   - &iqtree_exec                    # REQUIRED: IQ-TREE command-line                              (ex: 'iqtree')
   - &iqtree_options                 # REQUIRED: IQ-TREE command-line options                      (ex: '-m MFP -bb 1000 -wbtl')
   - &iqtree_ufboot_ext              # REQUIRED: IQ-TREE gene trees file extension                 (ex: '.ufboot')
   - &iqtree_modules                 # REQUIRED: modules needed to run IQ-TREE                     (ex: 'iq-tree/2.0.7', use '' if non is needed)
   - &iqtree_slurm_options           # REQUIRED: IQ-TREE slurm options                             (ex: '--mem=1G --time=00:20:00')
   # ALE
   - &ale_object_exec                # REQUIRED: ALEobserve command-line                           (ex: !join [*run_dir_bin,'ALE/bin/ALEobserve'])
   - &ale_object_ext                 # REQUIRED: ALE object file extension                         (ex: '.ale')
   - &ale_uml_exec                   # REQUIRED: ALEml_undated command-line                        (ex: !join [*run_dir_bin,'ALE/bin/ALEml_undated']
   - &ale_uml_options                # REQUIRED: ALEml_undated command-line options                (ex: !concat ['sample=1 tau=0 separators="', *species_gene_name_separator, '"'])
   - &ale_uml_rec_ext                # REQUIRED: ALEml_undated reconciliation file extension       (ex: '.uml_rec')
   - &ale_modules                    # REQUIRED: modules needed to run ALE                         (ex: '', no module needed)
   - &ale_slurm_options              # REQUIRED: ALE slurm options                                 (ex: '--mem=2G --time=02:00:00')
   # DeCoSTAR
   - &decostar_exec                  # REQUIRED: DeCoSTAR command line                             (ex: !join [*run_dir_bin, 'DeCoSTAR'])
   - &decostar_input_path            !ref [*data_reconciliations_path]
   - &decostar_already_reconciled    'true'
   - &decostar_dupli_cost            '1'
   - &decostar_loss_cost             '1'
   - &decostar_dated_species_tree    # REQUIRED: 'true', 'false'
   - &decostar_rooted                'true' if ALE
   - &decostar_nb_sample             # REQUIRED: number of sampled adjacency forests per family    (ex: '1000')
   - &decostar_boltzmann_temperature # REQUIRED: Boltzmann temperature for sampling                (ex: '0.1')
   - &decostar_stats_thresholds      # REQUIRED: weight thresholds for ancestral adjacencies stats (ex: "0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0")
   - &decostar_modules               # REQUIRED: modules needed to run DeCoSTAR                    (ex: '')
   - &decostar_slurm_options         # REQUIRED: DeCoSTAR slurm options                            (ex: '--mem=4G --time=24:00:00')
   # SPP-DCJ
   - &sppdcj_gurobi_exec             # REQUIRED: gurobi command-line                               (ex: 'gurobi_cl')
   - &sppdcj_gurobi_options          # REQUIRED: gurobi command-line options                       (ex: 'MIPGap=0.05')
   - &sppdcj_bin_dir                 # OPTIONAL: directory of spp_dcj scripts                      (ex: !join [*run_dir_bin, 'spp_dcj', 'scripts'])
   - &sppdcj_writesol_exec           # REQUIRED: path to file sol2adjacencies.py                   (ex: !join [*sppdcj_bin_dir, 'sol2adjacencies.py'])
   - &sppdcj_ilp_exec                # REQUIRED: path to file spp_dcj.py                           (ex: !join [*sppdcj_bin_dir, 'spp_dcj.py'])
   - &sppdcj_ilp_threshold           # REQUIRED: weight threshold for adjacencies to consider      (ex: '0.5')
   - &sppdcj_ilp_alpha               # REQUIRED: alpha parameter of SPPDCJ model                   (ex: '0.5')
   - &sppdcj_ilp_beta                # REQUIRED: beta parameter of SPPDCJ model                    (ex: '0.25')
   - &sppdcj_input_species           # REQUIRED: species to consider                               (ex: 'all' or 'species1 species2 ... speciesk')
   - &sppdcj_input_suffix            # REQUIRED: suffix of result files                            (ex: 'all')
   - &sppdcj_ilp_modules             # REQUIRED: modules needed to create the ILP                  (ex: '')
   - &sppdcj_modules                 # REQUIRED: modules needed to solve the ILP                   (ex: 'gurobi')
   - &sppdcj_ilp_slurm_options       # REQUIRED: slurm options to create the ILP                   (ex: '--mem=256G --time=24:00:00')
   - &sppdcj_slurm_options           # REQUIRED: slurm options to solve the ILP                    (ex: '--mem=50G --time=12:00:00')

## DO NOT EDIT #############################################################################
## AGO pipeline

log:
   ext:
      log:  &log_ext_log  'log'
      err:  &log_ext_err  'err'
      stat: &log_ext_stat 'csv'
   msg:
      success: &log_msg_success 'SUCCESS'
      error:   &log_msg_error   'ERROR'
      warning: &log_msg_warning 'WARNING'
      missing: &log_msg_missing 'file is missing'

tools:   
   # MACSE: multiple sequences alignment
   MACSE:
      name: &macse_name 'MACSE'
      input:
         file: &macse_input_file !ref [*data_sequences_path]
      output:
         file: &macse_output_file !ref [*data_alignments_path]
      slurm:
         options: !ref [*macse_slurm_options]
         modules: !ref [*macse_modules]
         array:
            input:
               file:  &macse_slurm_array_input_file  !ref [*macse_input_file]
               field: &macse_slurm_array_input_field 2
               var:   &macse_slurm_array_input_var   'SEQ_FILE'
            results:
               file:  &macse_slurm_array_results_file  !ref [*macse_input_file]
               field: &macse_slurm_array_results_field 1
               var:   &macse_slurm_array_results_var   'FAM_ID'
               ext:   &macse_slurm_array_results_ext   !ref [*data_alignments_NT_ext]
         results:
            dir: &macse_results_dir  !join [*dir_results, *macse_name]
            files:
                - &macse_slurm_results_file_1 !join [
                     *macse_results_dir,
                     !concat ['${', *macse_slurm_array_results_var, '}', *data_alignments_NT_ext]
                  ]
                - &macse_slurm_results_file_2 !join [
                     *macse_results_dir,
                     !concat ['${', *macse_slurm_array_results_var, '}', *data_alignments_AA_ext]
                  ]
         cmd:
            - !concat ['java -jar ', *macse_exec, ' \']
            - '   -prog alignSequences \'
            - !concat ['   -seq ${', *macse_slurm_array_input_var, '} \']
            - !concat ['   -out_NT ', *macse_slurm_results_file_1, ' \']
            - !concat ['   -out_AA ', *macse_slurm_results_file_2]
            - !concat ["sed -i 's/!/-/g' ",*macse_slurm_results_file_1]
            - !concat ["sed -i 's/?/-/g' ",*macse_slurm_results_file_1]
            - !concat ["sed -i 's/!/-/g' ",*macse_slurm_results_file_2]
            - !concat ["sed -i 's/?/-/g' ",*macse_slurm_results_file_2]

   # IQ-TREE: gene trees inference
   IQ-TREE:
      name: &iqtree_name 'IQ-TREE'
      input:
         file: &iqtree_input_file !ref [*data_alignments_path]
      output:
         file: &iqtree_output_file !ref [*data_gene_trees_path]
      slurm:
         options: !ref [*iqtree_slurm_options]
         modules: !ref [*iqtree_modules]
         array:
            input:
               file:  &iqtree_slurm_array_input_file  !ref [*iqtree_input_file]
               field: &iqtree_slurm_array_input_field 2
               var:   &iqtree_slurm_array_input_var   'MSA_FILE'
            results:
               file:  &iqtree_slurm_array_results_file  !ref [*iqtree_input_file]
               field: &iqtree_slurm_array_results_field 1
               var:   &iqtree_slurm_array_results_var   'FAM_ID'
               ext:   &iqtree_slurm_array_results_ext   !ref [*iqtree_ufboot_ext]
         results:
            dir: &iqtree_results_dir !join [*dir_results, *iqtree_name]
            files:
                - &iqtree_slurm_results_file_ufboot !join [
                     *iqtree_results_dir,
                     !concat ['${', *iqtree_slurm_array_results_var, '}', *iqtree_ufboot_ext]
                  ]
         cmd:
            - !concat [*iqtree_exec, ' \']
            - !concat ['   -s ${',*iqtree_slurm_array_input_var,'} \']
            - !concat ['   ',*iqtree_options,' \']
            - !concat ['   -pre ',*iqtree_results_dir,'/${',*iqtree_slurm_array_results_var,'}']

   # ALE: gene tree reconcilliation from gene tree sample
   ALE:
      name: &ale_name 'ALE'
      input:
         dir:  &ale_input_dir !join [*dir_aux, *ale_name]
         name: &ale_input_species_tree_name  'species_tree.newick'
         file: &ale_input_species_tree_path  !join [*ale_input_dir, *ale_input_species_tree_name]
         script:
            - !join [*run_dir_scripts, 'newick_utils.py']
            - 'unlabel'
            - !ref [*data_species_tree_path]
            - !ref [*ale_input_species_tree_path]
      output:
         file: &ale_output_file !ref [*data_reconciliations_path]
      slurm:
         options: !ref [*ale_slurm_options]
         modules: !ref [*ale_modules]
         array:
            input:
               file:  &ale_slurm_array_input_file  !ref [*data_gene_trees_path]
               field: &ale_slurm_array_input_field 2
               var:   &ale_slurm_array_input_var   'TREES_FILE'
            results:
               file:  &ale_slurm_array_results_file  !ref [*data_gene_trees_path]
               field: &ale_slurm_array_results_field 1
               var:   &ale_slurm_array_results_var   'FAM_ID'
               ext:   &ale_slurm_array_results_ext   !ref [*data_reconciliations_ext]
         results:
            dir: &ale_results_dir !join [*dir_results, *ale_name]
            files:
                - &ale_slurm_result_file_ale_object !join [
                     *ale_results_dir,
                     !concat ['${', *ale_slurm_array_input_var, '##*/}', *ale_object_ext]
                  ]
                - &ale_slurm_results_file_uml_rec !join [
                     *ale_results_dir,
                     !concat [
                         *ale_input_species_tree_name, '_',
                         '${', *ale_slurm_array_input_var, '##*/}',
                         *ale_object_ext,*ale_uml_rec_ext
                     ]
                  ]
                - &ale_result_file_recphyloxml !join [
                     *ale_results_dir,
                     !concat ['${', *ale_slurm_array_results_var, '}',*data_reconciliations_ext]
                  ]
         cmd:
            - !concat ['cd ',*ale_results_dir]
            - ' '
            - !concat [*ale_object_exec, ' ${',*ale_slurm_array_input_var,'}']
            - ' '
            - !concat ['mv  ${',*ale_slurm_array_input_var,'}', *ale_object_ext, ' ', *ale_results_dir]
            - ' '
            - !concat [*ale_uml_exec, ' \']
            - !concat ['   ', *ale_input_species_tree_path,' \']
            - !concat ['   ', *ale_slurm_result_file_ale_object, ' \']
            - !concat ['   ', *ale_uml_options]
            - ' '
            - !concat ['grep -h "S:" ',*ale_slurm_results_file_uml_rec,' \']
            - !concat ['   | cut -f 2 > temp${', *ale_slurm_array_results_var, '}_st.nhx']
            - ' '
            - !concat ['grep "1 reconciled G-s:" -A 2 ', *ale_slurm_results_file_uml_rec ,' \']
            - !concat ['   | tail -1 > temp${', *ale_slurm_array_results_var, '}_rec.nhx']
            - ' '
            - !concat ['python ', !join [*run_dir_scripts, 'ALEtoRecXML.py'],' \']
            - !concat ['   -g temp${', *ale_slurm_array_results_var, '}_rec.nhx \']
            - !concat ['   -o temp${', *ale_slurm_array_results_var, '}_rec.xml \']
            - !concat ['   -s "', *species_gene_name_separator,'" \']
            - !concat ['   -st temp${', *ale_slurm_array_results_var, '}_st.nhx']
            - ' '
            - !concat [!join [*run_dir_scripts, 'ALE_reformat.py'], ' \']
            - !concat ['   ', *data_species_tree_path, ' \']
            - !concat ['   temp${', *ale_slurm_array_results_var, '}_st.nhx \']
            - !concat ['   temp${', *ale_slurm_array_results_var, '}_rec.xml \']
            - !concat ['   ', *ale_result_file_recphyloxml]
            - ' '
            - !concat ['rm temp${', *ale_slurm_array_results_var, '}_*.*']
      stats:
         files:
            - &ale_stats_file_species  !join [
                 *dir_stats, *ale_name, !concat [*ale_name, '_species.', *log_ext_stat]
              ]
            - &ale_stats_file_families  !join [
                 *dir_stats, *ale_name, !concat [*ale_name, '_families.', *log_ext_stat]
              ]
         cmd:
            - !join [*run_dir_scripts, 'recPhyloXML_statistics.py']
            - !ref [*ale_output_file]
            - !ref [*ale_stats_file_species]
            - !ref [*ale_stats_file_families]

   # DeCoSTAR: computing ancestral adjacencies
   DeCoSTAR:
      name: &decostar_name 'DeCoSTAR'
      input:
         dir:  &decostar_input_dir !join [*dir_aux, *decostar_name]
         file:
           - &decostar_input_file_trees       !join [*decostar_input_dir, 'gene_trees.txt']
           - &decostar_input_file_adjacencies !join [*decostar_input_dir, 'adjacencies.txt']
         script:
            - !join [*run_dir_scripts, 'DeCoSTAR_create_input_files.py']
            - !ref [*data_gene_orders_path]
            - !ref [*decostar_input_path]
            - !ref [*data_families_path]
            - !ref [*decostar_input_file_adjacencies]
            - !ref [*decostar_input_file_trees]
      output:
         file: &decostar_output_file !ref [*data_adjacencies_path]
      slurm:
         options: !ref [*decostar_slurm_options]
         modules: !ref [*decostar_modules]
         array:
            results:
               file:  &decostar_slurm_array_results_file  !ref [*data_species_path]
               field: &decostar_slurm_array_results_field 1
               var:   &decostar_slurm_array_results_var   'SPECIES'      
         results:
            dir: &decostar_results_dir  !join [*dir_results, *decostar_name]
            files:
                - &decostar_slurm_results_species_adjacencies !join [
                     *decostar_results_dir,
                     !concat ['${', *decostar_slurm_array_results_var, '}_adjacencies.txt']
                  ]
            other:
                - &decostar_slurm_results_adjacencies_file !join [*decostar_results_dir, 'adjacencies.txt']
                - &decostar_slurm_results_genes_file_1     !join [*decostar_results_dir, 'genes.txt']
                - &decostar_slurm_results_genes_file_2     !join [*decostar_results_dir, 'genes_reformatted.txt']
                - &decostar_slurm_results_species_file     !join [*decostar_results_dir, 'species.txt']
         cmd:
            - !concat [*decostar_exec, ' \']
            - !concat ['   species.file=', *data_species_tree_path, ' \']
            - !concat ['   adjacencies.file=', *decostar_input_file_adjacencies, ' \']
            - !concat ['   gene.distribution.file=', *decostar_input_trees, ' \']
            - !concat ['   output.dir=', *decostar_results_dir, ' \']
            - '   write.newick=true \'
            - '   write.adjacencies=true \'
            - '   write.genes=true \'
            - !concat ['   already.reconciled=' , *decostar_already_reconciled, ' \']
            - !concat ['   dupli.cost=' , *decostar_dupli_cost, ' \']
            - !concat ['   loss.cost=' , *decostar_loss_cost, ' \']
            - '   use.boltzmann=true \'
            - '   char.sep="|" \'
            - !concat ['   boltzmann.temperature=', *decostar_boltzmann_temperature, ' \']
            - !concat ['   nb.sample=', *decostar_nb_sample, ' \']
            - !concat ['   dated.species.tree=', *decostar_dated_species_tree, ' \']
            - !concat ['   rooted=', *decostar_rooted, ' \']
            - '   with.transfer=false \'
            - '   verbose=2'
            - ' '
            - !concat [!join [*run_dir_scripts, 'DeCoSTAR_reformat.py'], ' \']
            - !concat ['   ', *data_species_path, ' \']
            - !concat ['   ', *decostar_slurm_results_species_file, ' \']
            - !concat ['   ', *decostar_already_reconciled, ' \']
            - !concat ['   ', *data_families_path, ' \']
            - !concat ['   ', *decostar_input_path, ' \']
            - !concat ['   ', *decostar_input_file_trees, ' \']
            - !concat ['   ', *decostar_slurm_results_genes_file_1, ' \']
            - !concat ['   ', *decostar_slurm_results_adjacencies_file, ' \']
            - !concat ['   ', *decostar_slurm_results_genes_file_2, ' \']
            - !concat ['   ', *decostar_results_dir]
      stats:
         files: 
            - &decostar_stats_file_species  !join [
                 *dir_stats, *decostar_name, !concat [*decostar_name, '.', *log_ext_stat]
              ]
            - &decostar_stats_file_conflicts  !join [
                 *dir_stats, *decostar_name, !concat [*decostar_name, '_', *sppdcj_ilp_threshold, '_conflicts.txt']
              ]
         cmd:
            - !join [*run_dir_scripts, 'DeCoSTAR_statistics.py']
            - !ref [*data_species_path]
            - !ref [*decostar_slurm_results_genes_file_2]
            - !ref [*data_adjacencies_path]
            - !ref [*decostar_stats_thresholds]
            - !ref [*decostar_stats_file_species]
            - ';'
            - !join [*run_dir_scripts, 'DeCoSTAR_statistics.py']
            - !ref [*data_species_path]
            - !ref [*decostar_slurm_results_genes_file_2]
            - !ref [*data_adjacencies_path]
            - !ref [*sppdcj_ilp_threshold]
            - !ref [*decostar_stats_file_conflicts]

   # SPPDCJ_ILP: Writing the SPPDCJ ILP file
   SPPDCJ_ILP:
      name:   &sppdcj_ilp_name 'SPPDCJ_ILP'
      suffix: !concat ['_', *sppdcj_input_suffix]
      input:
         dir: &sppdcj_ilp_input_dir !join [*dir_aux, *sppdcj_ilp_name]
         file:
           - &sppdcj_ilp_input_file_species_tree !join [
                *sppdcj_ilp_input_dir, !concat ['species_tree_', *sppdcj_input_suffix, '.txt']
             ]
           - &sppdcj_ilp_input_file_adjacencies_1  !join [
                *sppdcj_ilp_input_dir, !concat ['adjacencies_', *sppdcj_input_suffix, '.txt']
             ]
           - &sppdcj_ilp_input_file_adjacencies_2  !join [
                *sppdcj_ilp_input_dir, !concat ['adjacencies_complemented_', *sppdcj_input_suffix, '.txt']
             ]
           - &sppdcj_ilp_input_file_conflicts !join [
                *sppdcj_ilp_input_dir, !concat ['conflicts_', *sppdcj_input_suffix, '.txt']
             ]
           - &sppdcj_ilp_input_file_log !join [
                *sppdcj_ilp_input_dir, !concat ['adjacencies_', *sppdcj_input_suffix, '.log']
             ]
         script:
            - !join [*run_dir_scripts, 'SPPDCJ_create_input_files.py']
            - !ref [*data_adjacencies_path]
            - !ref [*data_species_tree_path]
            - !ref [*sppdcj_input_species]
            - !ref [*sppdcj_ilp_threshold]
            - !ref [*sppdcj_ilp_input_file_species_tree]
            - !ref [*sppdcj_ilp_input_file_adjacencies_1]
            - !concat [';']
            - !join [*run_dir_scripts, 'SPPDCJ_make_linearizable.py']
            - !ref [*sppdcj_ilp_input_file_adjacencies_1]
            - !ref [*sppdcj_ilp_input_file_adjacencies_2]
            - !ref [*sppdcj_ilp_input_file_log]
            - !concat [';']
            - !join [*run_dir_scripts, 'DeCoSTAR_statistics.py']
            - !ref [*data_species_path]
            - !ref [*decostar_slurm_results_genes_file_2]
            - !ref [*data_adjacencies_path]
            - !ref [*sppdcj_ilp_threshold]
            - !ref [*sppdcj_ilp_input_file_conflicts]

      slurm:
         options: !ref [*sppdcj_ilp_slurm_options]
         modules: !ref [*sppdcj_ilp_modules]
         results:
            dir: &sppdcj_ilp_results_dir  !join [*dir_results, *sppdcj_ilp_name]
            prefix: &sppdcj_results_prefix !concat [
                       *sppdcj_input_suffix, '_',
                       *sppdcj_ilp_threshold, '_',
                       *sppdcj_ilp_alpha, '_',
                       *sppdcj_ilp_beta
                    ]
            other:
                - &sppdcj_ilp_results_file_idmap !join [
                     *sppdcj_ilp_results_dir, !concat [*sppdcj_results_prefix, '.idmap']
                  ]
                - &sppdcj_ilp_results_file_ilp !join [
                     *sppdcj_ilp_results_dir, !concat [*sppdcj_results_prefix, '.ilp']
                  ]
         cmd:
            - !concat [*sppdcj_ilp_exec, ' \']
            - !concat ['   -m ', *sppdcj_ilp_results_file_idmap, ' \']
            - !concat ['   -a ', *sppdcj_ilp_alpha, ' \']
            - !concat ['   -b ', *sppdcj_ilp_beta, ' \']
            - !concat ['   -t ', ' \']
            - !concat ['   ', *sppdcj_ilp_input_file_species_tree, ' \']
            - !concat ['   ', *sppdcj_ilp_input_file_adjacencies_2, ' \']
            - !concat ['   > ', *sppdcj_ilp_results_file_ilp ]

      stats:
         dir: &sppdcj_ilp_stats_dir  !join [*dir_stats, *sppdcj_ilp_name]
         files:
            - &sppdcj_ilp_stats_file_log !join [
                 *sppdcj_ilp_stats_dir,
                 !concat ['components_', *sppdcj_input_suffix, '.log']
              ]
         cmd:
            - !join [*run_dir_scripts, 'SPPDCJ_adjs_to_components.py']
            - '-p'
            - '-o'
            - !ref [*sppdcj_ilp_stats_dir]
            - !ref [*sppdcj_ilp_input_file_adjacencies_2]
            - !ref [*sppdcj_ilp_stats_file_log]

   # SPPDCJ: Solving the SPPDCJ ILP
   SPPDCJ:
      name:   &sppdcj_name 'SPPDCJ'
      suffix: !concat ['_', *sppdcj_input_suffix]
      input:
         file:
           - &sppdcj_input_file_ilp !ref [*sppdcj_ilp_results_file_ilp]
           - &sppdcj_input_file_idmap !ref [*sppdcj_ilp_results_file_idmap]
      output:
           file: &sppdcj_output_file !ref [*data_ago_adjacencies_path]
      slurm:
         options: !ref [*sppdcj_slurm_options]
         modules: !ref [*sppdcj_modules]
         array:
            results:
               file:  &sppdcj_slurm_array_results_file  !ref [*data_species_path]
               field: &sppdcj_slurm_array_results_field 1
               var:   &sppdcj_slurm_array_results_var   'SPECIES'      
         results:
            dir: &sppdcj_results_dir  !join [*dir_results, *sppdcj_name]
            files: 
                - &sppdcj_slurm_results_file !join [
                     *sppdcj_results_dir, 
                     !concat ['${', *sppdcj_slurm_array_results_var, '}_adjacencies.txt']
                  ]
            other:
                - &sppdcj_results_file_sol !join [
                     *sppdcj_results_dir, !concat [*sppdcj_results_prefix, '.sol']
                  ]
                - &sppdcj_results_file_log !join [
                     *sppdcj_results_dir, !concat [*sppdcj_results_prefix, '.log']
                  ]
                - &sppdcj_results_file_adjacencies !join [
                     *sppdcj_results_dir, !concat [*sppdcj_results_prefix, '_adjacencies.txt']
                  ]
         cmd:
            - !concat [*sppdcj_gurobi_exec, ' \']
            - !concat ['   ', *sppdcj_gurobi_options, ' \']
            - !concat ['   ResultFile=', *sppdcj_results_file_sol, ' \']
            - !concat ['   ', *sppdcj_input_file_ilp, ' \']
            - !concat ['   > ', *sppdcj_results_file_log]
            - ' '
            - !concat [*sppdcj_writesol_exec, ' \']
            - !concat ['   ', *sppdcj_results_file_sol, ' \']
            - !concat ['   ', *sppdcj_input_file_idmap, ' \']
            - !concat ['   > ', *sppdcj_results_file_adjacencies]
            - ' '
            - !concat [!join [*run_dir_scripts, 'SPPDCJ_reformat.py'], ' \']
            - !concat ['   ', *data_adjacencies_path, '\']
            - !concat ['   ', *sppdcj_results_file_adjacencies, ' \']
            - !concat ['   ', *sppdcj_results_dir]
      stats:
         dir: &sppdcj_stats_dir  !join [*dir_stats, *sppdcj_name]
         files:
            - &sppdcj_stats_file !join [
                 *sppdcj_stats_dir,
                 !concat [*sppdcj_name, '_species.', *log_ext_stat]
              ]
         cmd:
            - !join [*run_dir_scripts, 'SPPDCJ_statistics.py']
            - !ref [*data_adjacencies_path]
            - !ref [*sppdcj_results_file_adjacencies]
            - !ref [*sppdcj_stats_file]